@*
    For more information on enabling MVC for empty projects, visit http://go.microsoft.com/fwlink/?LinkID=397860
*@
@model Web.Controllers.ContentListModel
<br />

<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>

<script type="text/javascript">

    var params = {
            p: @Model.Page,
            t: @Model.Tag,
            q: "@Model.SearchText"
        };

    function search(next) {
        $.extend( params, next );
        var url = '/questions?';

        if (typeof(next.t) !== "undefined")
            params.p = 1;

        url += 'p=' + params.p;
        url += '&t=' + params.t;
        url += '&q=' + params.q;

        window.location.href = url;
    }

</script>

<style>
    .question-preview {
        max-height: 100px;
        overflow: hidden;
    }

    .fadeout {
        height: 2em;
        background: -webkit-linear-gradient( rgba(252, 252, 252, 0) 0%, rgba(252, 252, 252, 1) 100% );
        background-image: -moz-linear-gradient( rgba(252, 252, 252, 0) 0%, rgba(252, 252, 252, 1) 100% );
        background-image: -o-linear-gradient( rgba(252, 252, 252, 0) 0%, rgba(252, 252, 252, 1) 100% );
        background-image: linear-gradient( rgba(252, 252, 252, 0) 0%, rgba(252, 252, 252, 1) 100% );
        background-image: -ms-linear-gradient( rgba(252, 252, 252, 0) 0%, rgba(252, 252, 252, 1) 100% );
    }
</style>

@*<form class="form-horizontal">*@
    <div class="form-group">
        <div class="col-sm-1"></div>
        <div class="col-xs-8 col-sm-6 col-lg-4">
            <input id="page-search" class="form-control" placeholder="search for" asp-for="@Model.SearchText">
        </div>

        <div class="col-xs-1">
            <button id="search_btn" type="submit" class="btn btn-primary" onclick="search({ q: $('#page-search').val() })"><span class="glyphicon glyphicon-search"></span></button>
        </div>

       
    </div>
@*</form>*@
<hr />

@if (Model.Content == null || Model.Content.Count == 0)
{
    <span>Sorry, no results found</span>
}
else if (!string.IsNullOrEmpty(Model.SearchText))
{
    <span>@Model.ResultsCount results found</span>
}

@foreach (var t in Model.Tags)
{
    @*@if (t.Id == Model.Tag)
        {
            <button class="btn btn-sm btn-primary active">@t.Name <span class="badge">@t.Count</span></button>
        }*@
    //else
    //{
    <button class="btn btn-sm" onclick="search({ t: @t.Id });">@t.Name <span class="badge">@t.Count</span></button>
    //}
}

@foreach (var q in Model.Content)
{
    <div class="media">
        <div class="media-left text-center">
            <h2 style="margin-bottom:-6px">@q.ChildrenCount</h2><small>
                <span>answers</span>
            </small>
        </div>
        <div class="media-body" style="padding-left:16px;">
            <a href="/questions/show?id=@q.Id"><h4>"@q.Title"</h4></a>

            @foreach (var t in q.Tags)
            {
                <button type="button" class="btn btn-sm">@t.Name</button>
            }

            @*<div style="position:relative">
                    <div class="question-preview">
                        @Html.Raw(q.HtmlBody)
                    </div>

                    <div class="fadeout" style="position:absolute; bottom:0; left:0; right:0"></div>
                </div>*@

            <div class="text-right">
                @if (!string.IsNullOrEmpty(q.User.ProfileImageUrl))
                {
                    <img src="@q.User.ProfileImageUrl" height="20" width="20" />
                }
                <small>@q.User.DisplayName</small>
                <br />
                <small> asked @Web.DateTimeFormatter.Format(@q.Created)</small>
            </div>
        </div>
    </div>
}

@if (Model.MaxPages > 1)
{
    <ul class="pagination">
        @for (var p = 1; p <= Model.MaxPages; p++)
        {
            var c = Model.Page == p ? "active" : "";
            <li class="@c"><button class="btn" onclick="search({ p: @p})">@p</button></li>
        }
    </ul>
}